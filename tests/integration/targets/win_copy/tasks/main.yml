---
- name: Create empty folder
  ansible.builtin.file:
    path: '{{ role_path }}/files/subdir/empty'
    state: directory
    mode: '0644'
  delegate_to: localhost

# removes the cached zip module from the previous task so we can replicate
# the below issue where win_copy would delete DEFAULT_LOCAL_TMP if it
# had permission to
# https://github.com/ansible/ansible/issues/35613
- name: Clear the local ansiballz cache
  ansible.builtin.file:
    path: "{{ lookup('config', 'DEFAULT_LOCAL_TMP') }}/ansiballz_cache"
    state: absent
  delegate_to: localhost

- name: Create test folder
  ansible.windows.win_file:
    path: '{{ test_win_copy_path }}'
    state: directory

- name: Run tests for win_copy module
  block:
    - name: Run tests for local to remote
      ansible.builtin.include_tasks: tests.yml

    - name: Run tests for remote to remote
      ansible.builtin.include_tasks: remote_tests.yml

  always:
    - name: Remove test folder
      ansible.windows.win_file:
        path: '{{ test_win_copy_path }}'
        state: absent
